{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-bg: #f5f7fa;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent-color: #3b82f6;
            --shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            --input-bg: #f9fafb;
            --border-color: #e5e7eb;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            margin: 0;
            min-height: 100vh;
            display: flex;
        }

        .main-content {
            margin-left: 250px;
            padding: 30px;
            flex: 1;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.8rem;
            font-weight: 600;
            animation: fadeIn 0.8s ease-out;
        }

        .form-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .form-container:hover {
            transform: translateY(-3px);
        }

        .form-header {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 5px;
            opacity: 0;
            animation: fadeInUp 0.5s forwards;
        }

        .form-group label:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .form-group label:nth-child(even) {
            animation-delay: 0.2s;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 8px;
            font-size: 0.9rem;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group textarea {
            height: 100px;
            resize: none;
        }

        .form-group input[type="file"] {
            padding: 5px;
            background: transparent;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.2);
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preview-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .form-container button {
            background: var(--accent-color);
            color: #ffffff;
            border: none;
            padding: 10px;
            font-weight: 500;
            font-size: 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            width: 100%;
        }

        .form-container button:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        #skin_type_container,
        #skin_tone_container,
        #hair_texture_container,
        #quantity_container {
            transition: all 0.3s ease-in-out;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.5rem;
            }
            .form-container {
                padding: 15px;
            }
        }
  .preview-thumb {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 8px;
    cursor: grab;
    border: 2px solid #ddd;
  }

    </style>
</head>
<body>
    {% include 'seller/seller_nave.html' %}

    <div class="main-content">
    <h1 style="color: #2e5189;">Add Product</h1>
    <p class="form-header">Please fill in the details of the product you'd like to add to your shop.</p>

    <!-- HTML Form Structure -->
<div class="form-container">
  <form method="post" enctype="multipart/form-data" id="addProductForm">
    {% csrf_token %}
    <div class="form-grid">
      <!-- Product Fields -->
      <div class="form-group">
        <label for="product_name">Product Name</label>
        <input type="text" id="product_name" name="product_name" placeholder="Product Name" required>
      </div>

      <div class="form-group">
        <label for="brand_name">Brand Name</label>
        <input type="text" id="brand_name" name="brand_name" value="{{ brand_name }}" readonly>
      </div>

      <div class="form-group">
        <label for="price">Price</label>
        <input type="number" id="price" step="0.01" name="price" placeholder="Price" required>
      </div>

      <div class="form-group" id="quantity_container" style="display:none;">
        <label for="quantity">Quantity</label>
        <select id="quantity" name="quantity">
          <option value="" disabled selected>Select Quantity</option>
          {% for value, label in quantity_choices %}
            <option value="{{ value }}">{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Product Description -->
      <div class="form-group full-width">
        <label for="description">Description</label>
        <textarea id="description" name="description" placeholder="Description" required></textarea>
      </div>

      <div class="form-group full-width">
        <label for="ingredients">Ingredients</label>
        <textarea id="ingredients" name="ingredients" placeholder="List of Ingredients"></textarea>
      </div>

      <div class="form-group full-width">
        <label for="how_to_use">How to Use</label>
        <textarea id="how_to_use" name="how_to_use" placeholder="Instructions for Use"></textarea>
      </div>

      <div class="form-group">
        <label for="expiry_date">Expiry Date</label>
        <input type="date" id="expiry_date" name="expiry_date">
      </div>

      <div class="form-group">
        <label for="country_of_origin">Country of Origin</label>
        <input type="text" id="country_of_origin" name="country_of_origin" placeholder="Country of Origin">
      </div>

      <div class="form-group">
        <label for="manufacturer">Manufacturer</label>
        <input type="text" id="manufacturer" name="manufacturer" placeholder="Manufacturer">
      </div>

      <!-- Image Upload -->
      <div class="form-group">
        <label for="images">Product Images</label>
        <input type="file" id="images" name="images" multiple accept="image/*">
        <small class="form-text text-muted">Drag images to reorder. First image will be the main one.</small>
        <div id="imagePreview" class="d-flex flex-wrap gap-2 mt-3"></div>
      </div>

      <!-- Product Type -->
      <div class="form-group">
        <label for="product_type">Product Type</label>
        <select id="product_type" name="product_type" required>
          <option value="" disabled selected>Select Product Type</option>
          <option value="Skincare">Skincare</option>
          <option value="Makeup">Makeup</option>
          <option value="Haircare">Haircare</option>
        </select>
      </div>

      <!-- Category -->
      <div class="form-group">
        <label for="category">Category</label>
        <select id="category" name="category" required>
          <option value="" disabled selected>Select Category</option>
          <option value="Cleanser">Cleanser</option>
          <option value="Moisturizer">Moisturizer</option>
          <option value="Serum">Serum</option>
          <option value="Sunscreen">Sunscreen</option>
          <option value="Foundation">Foundation</option>
          <option value="Lipstick">Lipstick</option>
          <option value="Mascara">Mascara</option>
          <option value="Eyeshadow">Eyeshadow</option>
          <option value="Shampoo">Shampoo</option>
          <option value="Conditioner">Conditioner</option>
          <option value="Hair Oil">Hair Oil</option>
          <option value="Hair Serum">Hair Serum</option>
        </select>
      </div>

      <!-- Dynamic Fields -->
      <div class="form-group" id="skin_type_container" style="display:none;">
        <label for="skin_type">Skin Type</label>
        <select id="skin_type" name="skin_type">
          <option value="None" selected>Select Skin Type</option>
          <option value="Oily">Oily</option>
          <option value="Dry">Dry</option>
          <option value="Combination">Combination</option>
          <option value="Sensitive">Sensitive</option>
        </select>
      </div>

      <div class="form-group" id="skin_tone_container" style="display:none;">
        <label for="skin_tone">Skin Tone</label>
        <select id="skin_tone" name="skin_tone">
          <option value="None" selected>Select Skin Tone</option>
          <option value="Fair">Fair</option>
          <option value="Light">Light</option>
          <option value="Medium">Medium</option>
          <option value="Tan">Tan</option>
          <option value="Deep">Deep</option>
        </select>
      </div>

      <div class="form-group" id="hair_texture_container" style="display:none;">
        <label for="hair_texture">Hair Texture</label>
        <select id="hair_texture" name="hair_texture">
          <option value="None" selected>Select Hair Texture</option>
          <option value="Straight">Straight</option>
          <option value="Wavy">Wavy</option>
          <option value="Curly">Curly</option>
          <option value="Coily">Coily</option>
        </select>
      </div>

      <button type="submit">Upload Product</button>
    </div>
  </form>
</div>
</div>

<!-- Required JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<script>
  const productTypeSelect = document.getElementById('product_type');
  const skinTypeContainer = document.getElementById('skin_type_container');
  const skinToneContainer = document.getElementById('skin_tone_container');
  const hairTextureContainer = document.getElementById('hair_texture_container');
  const quantityContainer = document.getElementById('quantity_container');

  function toggleFields() {
    const selected = productTypeSelect.value;
    skinTypeContainer.style.display = selected === 'Skincare' ? 'block' : 'none';
    skinToneContainer.style.display = selected === 'Makeup' ? 'block' : 'none';
    hairTextureContainer.style.display = selected === 'Haircare' ? 'block' : 'none';
    quantityContainer.style.display = (selected === 'Skincare' || selected === 'Haircare') ? 'block' : 'none';
  }

  productTypeSelect.addEventListener('change', toggleFields);
  window.addEventListener('DOMContentLoaded', toggleFields);

  // Image Preview and Sorting
  let selectedFiles = [];

  document.getElementById('images').addEventListener('change', function (event) {
    const previewContainer = document.getElementById('imagePreview');
    previewContainer.innerHTML = '';
    selectedFiles = Array.from(event.target.files);

    selectedFiles.forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'preview-thumb';
        img.setAttribute('data-index', index);
        previewContainer.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  new Sortable(document.getElementById('imagePreview'), {
    animation: 150,
    onEnd: function () {
      const newOrder = [];
      document.querySelectorAll('#imagePreview img').forEach(img => {
        const index = parseInt(img.getAttribute('data-index'));
        newOrder.push(selectedFiles[index]);
      });
      selectedFiles = newOrder;
    }
  });

  // SweetAlert Messages from Django
 {% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

document.getElementById('addProductForm').addEventListener('submit', function (e) {
    let isValid = true;
    let errors = [];

    const productName = document.getElementById('product_name').value.trim();
    const price = parseFloat(document.getElementById('price').value);
    const description = document.getElementById('description').value.trim();
    const images = document.getElementById('images').files;
    const expiryDate = document.getElementById('expiry_date').value;
    const productType = document.getElementById('product_type').value;

    // 1. Product Name
    if (productName.length < 3) {
        errors.push("Product name must be at least 3 characters long.");
        isValid = false;
    }

    // 2. Price Validation
    if (isNaN(price) || price <= 0) {
        errors.push("Price must be a positive number.");
        isValid = false;
    }

    // 3. Description
    if (description.length < 10) {
        errors.push("Description must be at least 10 characters.");
        isValid = false;
    }

    // 4. At least one image
    if (images.length === 0) {
        errors.push("Please upload at least one product image.");
        isValid = false;
    }

    // 5. Expiry date must be future
    if (expiryDate) {
        const today = new Date().setHours(0, 0, 0, 0);
        const selectedDate = new Date(expiryDate).setHours(0, 0, 0, 0);
        if (selectedDate <= today) {
            errors.push("Expiry date must be a future date.");
            isValid = false;
        }
    }

    // 6. Conditional fields
    if (productType === "Skincare" && document.getElementById('skin_type').value === "None") {
        errors.push("Please select a skin type for Skincare products.");
        isValid = false;
    }
    if (productType === "Makeup" && document.getElementById('skin_tone').value === "None") {
        errors.push("Please select a skin tone for Makeup products.");
        isValid = false;
    }
    if (productType === "Haircare" && document.getElementById('hair_texture').value === "None") {
        errors.push("Please select a hair texture for Haircare products.");
        isValid = false;
    }

    // Show errors
    if (!isValid) {
        e.preventDefault();
        Swal.fire({
            icon: 'error',
            title: 'Validation Error',
            html: errors.join('<br>'),
            confirmButtonColor: '#3b82f6'
        });
    }
});

</script>

</body>
</html>